# اختبار إصلاح مشكلة نظام الصلاحيات

## الحل السريع - 3 خطوات

### الخطوة 1: تطبيق SQL Script السريع
1. اذهب إلى [Supabase Dashboard](https://supabase.com/dashboard)
2. اختر مشروعك
3. SQL Editor → New Query
4. انسخ والصق محتوى ملف `quick-fix-permissions.sql`
5. اضغط **Run**

### الخطوة 2: التحقق من النجاح
ستظهر رسالة: `تم إصلاح مشكلة category_id بنجاح!`

### الخطوة 3: إعادة تحميل التطبيق
- حدث الصفحة (F5)
- يجب أن يختفي الخطأ

## إذا لم يعمل الحل الأول

### الحل البديل: استخدام البيانات الوهمية
النظام مُصمم للعمل حتى بدون جداول الصلاحيات:

1. **البيانات الوهمية متاحة**: النظام سيستخدم بيانات وهمية تلقائياً
2. **الوظائف الأساسية تعمل**: عرض الأدوار، الصلاحيات، الإحصائيات
3. **رسائل تحذيرية فقط**: في console المتصفح

### للتحقق من الوضع الحالي:
```javascript
// في console المتصفح (F12)
// تحقق من وجود جداول الصلاحيات
fetch('/rest/v1/permission_categories?limit=1', {
  headers: { 'apikey': 'your_anon_key' }
}).then(r => r.json()).then(console.log)
```

## ما يجب أن تراه بعد الإصلاح

### في صفحة Super Admin > Advanced Permissions:
✅ قائمة بالأدوار (7 أدوار أساسية)
✅ قائمة بالصلاحيات (مُقسمة حسب الفئات)
✅ إحصائيات النظام
✅ لا يوجد أخطاء في console

### الأدوار المُنشأة:
1. **مدير النظام العام** (super_admin) - المستوى 0
2. **مدير المؤسسة** (tenant_admin) - المستوى 10
3. **مدير** (manager) - المستوى 20
4. **محاسب** (accountant) - المستوى 30
5. **فني** (technician) - المستوى 40
6. **موظف استقبال** (receptionist) - المستوى 50
7. **مستخدم عادي** (user) - المستوى 100

### الفئات المُنشأة:
- إدارة النظام
- إدارة المستخدمين
- إدارة الأسطول
- الأعمال
- المالية
- أساسيات

## حل المشاكل

### المشكلة: "Cannot find project ref"
**الحل**: تطبيق SQL مباشرة في Supabase Dashboard بدلاً من CLI

### المشكلة: "Permission denied"
**الحل**: تأكد من أنك مُسجل دخول كـ super admin

### المشكلة: "Table already exists"
**الحل**: الاستعلام محمي ضد التكرار - لا مشكلة

### المشكلة: لا تزال ترى البيانات الوهمية
**الحل**: امسح cache المتصفح أو افتح نافذة خاصة

## الدعم التقني

إذا استمرت المشاكل، تحقق من:
1. **الاتصال بقاعدة البيانات**: هل يعمل النظام الأساسي؟
2. **صلاحيات المستخدم**: هل أنت super_admin؟
3. **سجل الأخطاء**: ماذا يظهر في Network tab؟

النظام مُصمم ليكون مقاوماً للأخطاء ويعمل في جميع الحالات - إما بالبيانات الحقيقية أو الوهمية. 