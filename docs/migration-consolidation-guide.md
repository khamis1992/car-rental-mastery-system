# ุฏููู ุฏูุฌ ูููุงุช ุงููุฌุฑุฉ (Migration Consolidation Guide)

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุฏูุฌ ุฃูุซุฑ ูู 80 ููู migration ุฅูู 3 ูููุงุช ุฑุฆูุณูุฉ ูุชุญุณูู ุฅุฏุงุฑุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุณููู ุงูุตูุงูุฉ.

## ุงููููุงุช ุงูุฑุฆูุณูุฉ ุงูุฌุฏูุฏุฉ

### 1. master-001-create-essential-indexes.sql
**ุงูุบุฑุถ:** ุฌููุน ููุงุฑุณ ุงูุฃุฏุงุก ูุงูุงุณุชุนูุงูุงุช ุงููุญุณูุฉ
**ูุญุชูู ุนูู:**
- ููุงุฑุณ ุฌุฏูู ุงูุนููุฏ (contracts)
- ููุงุฑุณ ุฌุฏูู ุงููุฏููุนุงุช (payments) 
- ููุงุฑุณ ุฌุฏูู ุงูููุงุชูุฑ (invoices)
- ููุงุฑุณ ุฌุฏูู ุงููุฑูุจุงุช (vehicles)
- ููุงุฑุณ ุฌุฏูู ุงูุนููุงุก (customers)
- ููุงุฑุณ ุฌุฏูู ุงูููุธููู (employees)
- ุฏุงูุฉ ูุฑุงูุจุฉ ุฃุฏุงุก ุงูุงุณุชุนูุงูุงุช

### 2. master-002-security-functions.sql
**ุงูุบุฑุถ:** ุฌููุน ุฏูุงู ุงูุฃูุงู ูุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ
**ูุญุชูู ุนูู:**
- ุชุนุฑูู user_role enum
- ุฌุฏูู tenant_user_roles
- ุฏูุงู ุงูุฃูุงู ุงูุฃุณุงุณูุฉ
- ุณูุงุณุงุช RLS ููุญูุงูุฉ
- ุฏุงูุฉ ุชุฏููู ุงูุฃูุงู

### 3. master-003-accounting-functions.sql
**ุงูุบุฑุถ:** ุฌููุน ุงูุฏูุงู ุงููุญุงุณุจูุฉ ูุงููุงููุฉ
**ูุญุชูู ุนูู:**
- ุฏุงูุฉ log_transaction ุงููุฏูุฌุฉ
- ุฏุงูุฉ ุชูููุฏ ุฃุฑูุงู ุงููููุฏ
- ุฏุงูุฉ ูููุฏ ุงูุนููุฏ
- ุฏุงูุฉ ูููุฏ ุงููุฏููุนุงุช
- ุฏุงูุฉ ูููุฏ ุงูุญุถูุฑ

## ุงููููุงุช ุงูุฌุฏูุฏุฉ ุงููุฏูุฌุฉ

### ๐ ูุฌูุฏ ุงููููุงุช ุงููุฏูุฌุฉ
ุชู ุฅูุดุงุก ุงููููุงุช ุงููุฏูุฌุฉ ูู: `docs/master-migrations/`

### โ ุงููููุงุช ุงููุชููุฑุฉ
- `master-001-create-essential-indexes.sql` - ุฌููุน ุงูููุงุฑุณ ุงูุฃุณุงุณูุฉ
- `master-002-security-functions.sql` - ุฏูุงู ุงูุฃูุงู ูุงูุฃุฏูุงุฑ
- `master-003-accounting-functions.sql` - ุงูุฏูุงู ุงููุญุงุณุจูุฉ ุงูุดุงููุฉ  
- `migration-deployment-script.sh` - ุณูุฑูุจุช ุงููุดุฑ ุงูุขูู

## ุงููููุงุช ุงููุณุชุจุนุฏุฉ

### ูููุงุช ุงูููุงุฑุณ (ุชู ุฏูุฌูุง ูู master-001)
```
20250723175747-321bf17b-b1ba-452a-91eb-eff3f6a7b0a2.sql
20250723175832-c17d9228-19ea-4027-a681-6abb6199c996.sql
20250723175900-84280388-2a02-4322-a227-5bc99d79ff4d.sql
```

### ูููุงุช ุงูุฃูุงู (ุชู ุฏูุฌูุง ูู master-002)
```
20250723171734-99d2b36b-f933-4276-a50b-8de3da9e409f.sql
20250723172109-a9e0f2c5-8426-4065-bfb8-c877cfbff30d.sql
20250723172337-07be6437-676f-4ebd-a0ae-6da650d57de4.sql
20250723173244-c1d63833-7698-4c3a-a094-f49cc8f9a945.sql
20250723173456-dd678057-fb37-42b8-89c8-7efe70ed42ff.sql
```

### ูููุงุช ุงููุญุงุณุจุฉ (ุชู ุฏูุฌูุง ูู master-003)
```
20250707040113-d6984b4e-3145-42f4-b9c5-a4da8f1ef23e.sql
20250707042754-7da4e366-4b98-495b-a38f-e0c69c86f83c.sql
20250707050649-66db3223-bfbc-47d9-a59d-ca7373abd769.sql
20250706141041-24b5a44c-083c-4a4a-a1b2-341218826537.sql
20250706141259-2b5748a1-67ea-4d2d-8073-ac007ef01fd6.sql
20250706141556-c0518575-f33d-4130-ae2d-c15bdce9bc78.sql
```

## ุฎุทูุงุช ุงูุชุทุจูู

### 1. ุงูุทุฑููุฉ ุงูุขููุฉ (ูุณุชุญุณูุฉ)
```bash
# ุชุดุบูู ุณูุฑูุจุช ุงููุดุฑ ุงูุขูู
chmod +x docs/master-migrations/migration-deployment-script.sh
DATABASE_URL="your_database_url" ./docs/master-migrations/migration-deployment-script.sh
```

### 2. ุงูุทุฑููุฉ ุงููุฏููุฉ
```bash
# ุงููุณุฎ ุงูุงุญุชูุงุทู
pg_dump your_database > backup_before_consolidation.sql

# ุชุทุจูู ูููุงุช ุงูู master ุจุงูุชุฑุชูุจ
psql -d your_database -f docs/master-migrations/master-001-create-essential-indexes.sql
psql -d your_database -f docs/master-migrations/master-002-security-functions.sql
psql -d your_database -f docs/master-migrations/master-003-accounting-functions.sql
```

### 3. ุงูุชุญูู ูู ุงูุชุทุจูู
```sql
-- ุงูุชุญูู ูู ุงูููุงุฑุณ
SELECT * FROM public.get_query_performance_stats();

-- ุงูุชุญูู ูู ุงูุฃูุงู
SELECT * FROM public.security_audit_report();

-- ุงูุชุญูู ูู ุงูุฏูุงู ุงููุญุงุณุจูุฉ
SELECT routine_name FROM information_schema.routines 
WHERE routine_schema = 'public' 
AND routine_name LIKE '%accounting%';
```

### 4. ุญุฐู ุงููููุงุช ุงููุณุชุจุนุฏุฉ
```bash
# ุญุฐู ุงููููุงุช ุงููุฏููุฉ (ุจุนุฏ ุงูุชุฃูุฏ ูู ูุฌุงุญ ุงูุชุทุจูู)
rm supabase/migrations/20250723175747-*.sql
rm supabase/migrations/20250723175832-*.sql
# ... ุจุงูู ุงููููุงุช
```

## ุงูููุงุฆุฏ

### โ ุชุญุณููุงุช ุงูุฃุฏุงุก
- ุชูููู ูู 80+ ููู ุฅูู 3 ูููุงุช ุฑุฆูุณูุฉ
- ุชุณุฑูุน ุนูููุฉ ุงููุดุฑ (deployment)
- ุชุณููู ุฅุฏุงุฑุฉ ุงูุชุจุนูุงุช

### โ ุชุญุณููุงุช ุงูุตูุงูุฉ
- ููุฏ ุฃูุซุฑ ุชูุธููุงู
- ุณูููุฉ ุงูุชุชุจุน ูุงูุชุตุญูุญ
- ุฅุฒุงูุฉ ุงูุชูุฑุงุฑ

### โ ุชุญุณููุงุช ุงูุชุทููุฑ
- ููู ุฃุณุฑุน ูููุธุงู
- ุชุทููุฑ ุฃุณูู ููููุฒุงุช ุงูุฌุฏูุฏุฉ
- ุงุฎุชุจุงุฑ ุฃุจุณุท

## ุฅุฑุดุงุฏุงุช ุงููุณุชูุจู

### ูููููุงุช ุงูุฌุฏูุฏุฉ
1. ุงุณุชุฎุฏู ุงูุชุตููู ุงููุธููู (functional categorization)
2. ุงุฏูุฌ ุงููููุงุช ุงููุชุฑุงุจุทุฉ
3. ุชุฌูุจ ุงูุชูุฑุงุฑ
4. ุงูุชุจ ูุซุงุฆู ูุงุถุญุฉ

### ูุฅุฏุงุฑุฉ ุงููุฌุฑุฉ
1. ุฑุงุฌุน ุงููููุงุช ุฏูุฑูุงู (ูู 3 ุฃุดูุฑ)
2. ุงุฏูุฌ ุงููููุงุช ุงููุชุดุงุจูุฉ
3. ุงุญุชูุธ ุจุณุฌู ุงูุชุบููุฑุงุช
4. ุงุฎุชุจุฑ ูุจู ุงููุดุฑ

## ุงููุณุงุนุฏุฉ ูุงูุฏุนู
- ูููุดุงูู ุงูุชูููุฉ: ุฑุงุฌุน ุณุฌูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ููุงุณุชูุณุงุฑุงุช: ุงุณุชุฎุฏู ุฏุงูุฉ security_audit_report()
- ูููุฑุงูุจุฉ: ุงุณุชุฎุฏู ุฏุงูุฉ get_query_performance_stats()